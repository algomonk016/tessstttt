class LimeChatWhatsapp{constructor({accessToken:t,phoneNumber:e}){this.accessToken=t,this.phoneNumber=e,this.getConfig=this.getConfig.bind(this),this.initializeWidget=this.initializeWidget.bind(this)}async getConfig(){try{let t=await fetch(`https://app-whatsapp-widget.limechat.ai/api/getWidgetConfig/${this.phoneNumber}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!t.ok)throw Error(`Error fetching config: ${t.status}`);let e=await t.json();return Object.assign(this,e),e}catch(s){return console.error("Error fetching config:",s),null}}async initializeWidget(){await this.getConfig()&&this.renderWidget()}deviceCheck(t){let e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return"desktop"===t&&!e||!("mobile"!==t||!e)||"both"===t||void 0}titleCase(t){let e=t.toLowerCase().split(" ");for(let s=0;s<e.length;s++)e[s]=e[s].charAt(0).toUpperCase()+e[s].substring(1);return e.join(" ")}renderWidget(){this.deviceCheck(this.display_on)&&this.renderButton()}pageCheck(t){let e=!1;return t.forEach(t=>{"homepage"==t&&"/"==window.location.pathname&&(e=!0),"collections"==t&&window.location.pathname.includes("/collections/")&&(e=!0),"products"==t&&window.location.pathname.includes("/products/")&&(e=!0),"cart"==t&&"/cart"==window.location.pathname&&(e=!0),"pages"==t&&window.location.pathname.includes("/pages/")&&(e=!0),"checkout"==t&&window.location.pathname.includes("/checkouts/")&&(e=!0),"blogs"==t&&window.location.pathname.includes("/blogs/")&&(e=!0)}),e}getParameterByName(t,e){t=t.replace(/[\[\]]/g,"\\$&");let s=RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}appendCurrentUrl(t){let e=window.location.href;return`Hi, I was browsing ${e} and have a few questions`}renderButton(){if(this.pageCheck(this.pages_to_display)||!this.isShopify){let t=document.createElement("script");t.setAttribute("src","https://kit.fontawesome.com/2640aa91b4.js"),document.body.appendChild(t);let e=document.createElement("link");e.setAttribute("href","https://fonts.googleapis.com/css2?family=Lato&family=Roboto&display=swap"),e.setAttribute("rel","stylesheet"),document.body.appendChild(e);let s=document.createElement("link");s.setAttribute("href","https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/LC_whatsapp_stylesheet.css"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),document.body.appendChild(s);let i=1e3!==this.zIndex?this.zIndex:1e3,p=document.createElement("div");p.className="WhatsAppButton__root",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"left"===this.position_mobile?p.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; left: ${this.left_margin_mobile}px; z-index: ${i};`):p.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; right: ${this.right_margin_mobile}px; z-index: ${i};`):"left"===this.position_desktop?p.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; left: ${this.left_margin_desktop}px; z-index: ${i};`):p.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; right: ${this.right_margin_desktop}px; z-index: ${i};`),document.body.appendChild(p);let o=document.createElement("a"),l=document.createElement("a");if(window.location.pathname.includes("/products/")&&""!==this.pdp_prefill_text&&this.isShopify&&(window.location.href.includes("variant")&&!this.includeVariant||!window.location.href.includes("variant")&&this.includeVariant||!window.location.href.includes("variant")&&!this.includeVariant)){let a=window.location.href,h=a.split("/products/"),n="";var r=(n=h[1].includes("?")?h[1].split("?")[0]:h[1]).replace(/\-/g," ").replace(/\//g,""),d=`${n}.xml`;d=a.replace(n,d);var b=this.titleCase(r);fetch(d).then(t=>{t.text().then(t=>new DOMParser().parseFromString(t,"text/xml")).then(t=>t.querySelector("title")).then(t=>t.textContent).then(t=>{t=t.replaceAll("&","%26");try{let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}catch(s){let i=this.appendCurrentUrl(`${this.pdp_prefill_text} ${b}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`)}})})}else if(window.location.pathname.includes("/collections/")&&!window.location.pathname.includes("/products/")&&this.isShopify){let m=window.location.href.split("collections/"),u="";r=(u=m[1].includes("?")?m[1].split("?")[0]:m[1]).replace(/\-/g," ").replace(/\//g,"");let g=this.titleCase(r),c=this.appendCurrentUrl(`Hey! I would like to know more about ${g}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${c}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${c}`)}else if(window.location.pathname.includes("/products/")&&window.location.href.includes("variant")&&""!==this.pdp_prefill_text&&this.isShopify&&this.includeVariant){let y=window.location.href,f=y.split("products/"),x="";r=(x=f[1].includes("?")?f[1].split("?")[0]:f[1]).replace(/\-/g," ").replace(/\//g,""),d=`${x}.xml`,d=y.replace(x,d),b=this.titleCase(r);let w=this.getParameterByName("variant",window.location.href);fetch(d).then(t=>{t.text().then(t=>new DOMParser().parseFromString(t,"text/xml")).then(t=>[t.querySelectorAll("variant"),t.querySelector("title"),]).then(t=>{for(let e of t[0])if(e.querySelector("id").textContent===w){let s=[],i=1,p=e.querySelector(`option${i}`);for(;p;)p.textContent&&s.push(p.textContent),i++,p=e.querySelector(`option${i}`);return[s.join(" / "),t[1].textContent]}}).then(t=>{try{let e=t[0],s=e.replace(/\-/g," ").replace(/\//g,""),i=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t[1].replaceAll("&","%26")} ${s}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`)}catch(p){let a=this.appendCurrentUrl(`${this.pdp_prefill_text} ${b}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${a}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${a}`)}})}).catch(t=>{let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${b}`);o.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)})}else{let A=this.appendCurrentUrl(this.prefill_text);o.setAttribute("href",`https://wa.me/${this.phone}?text=${A}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${A}`)}if(o.setAttribute("style","text-decoration: none"),o.setAttribute("target","_blank"),p.appendChild(o),l.setAttribute("target","_blank"),l.setAttribute("class","whatsapp__poweredBy"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if("widget_text"===this.widget_type_mobile){let _=document.createElement("button");_.setAttribute("class","landbot-whatsapp__button"),_.setAttribute("style",`min-width:${this.display_size_mobile}px; padding:${this.display_size_mobile/16}px`),o.appendChild(_);let k=document.createElement("i");k.setAttribute("class","fab fa-whatsapp"),k.setAttribute("style","font-size: 24px; margin-right: 5px"),_.appendChild(k);let z=document.createElement("p");z.setAttribute("style","margin: 0"),z.innerText=this.button_message_mobile,_.appendChild(z),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`))):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):l.setAttribute("style",`left: ${this.display_size_desktop+this.button_message_mobile.length+8}px;`))),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; right: 0px;`))}else{let $=document.createElement("img");$.src="https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_WA.png",$.setAttribute("style",`width:${this.display_size_mobile}px; opacity:1`),$.setAttribute("alt","WhatsApp Icon"),o.appendChild($),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`left: ${this.display_size_mobile+12}px;`)):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),l.setAttribute("style",`right: ${this.display_size_mobile+12}px;`)),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; right: 0px;`))}}else if("widget_text"===this.widget_type_desktop){let C=document.createElement("button");C.setAttribute("class","landbot-whatsapp__button"),C.setAttribute("style",`min-width:${this.display_size_desktop}px; padding:${this.display_size_desktop/16}px`),o.appendChild(C);let B=document.createElement("i");B.setAttribute("class","fab fa-whatsapp"),B.setAttribute("style","font-size: 24px; margin-right: 5px"),C.appendChild(B);let E=document.createElement("p");E.setAttribute("style","margin: 0"),E.innerText=this.button_message_desktop,C.appendChild(E),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;"))):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;"))),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; right: 0px;`))}else{let v=document.createElement("img");v.src="https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_WA.png",v.setAttribute("style",`width:${this.display_size_desktop}px; opacity:1`),v.setAttribute("alt","WhatsApp Icon"),o.appendChild(v),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`left: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;`)):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),l.setAttribute("style",`right: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;
                
                `)),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_desktop+12}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${1.5*this.display_size_desktop}px; right: 0px;`))}document.createElement("div");let S=document.createElement("img");this.pop_up_image.length>2&&(S.src=this.pop_up_image,S.setAttribute("style","width:24px;\n            float:left;\n            height:24px;\n            margin-right: 5px;\n            margin-top:-4px;\n            border-radius: 50%;"));let L=document.createElement("img");L.src="https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_close.png",L.setAttribute("class","closePopUp"),L.removeAttribute("href"),L.addEventListener("click",t=>{l.remove(),t.preventDefault()},!1),l.innerText=this.pop_up_message_text,this.show_pop_up&&setTimeout(()=>{l.append(L),S.src.length>2&&l.prepend(S),p.appendChild(l)},1e3*this.pop_up_delay)}}}
