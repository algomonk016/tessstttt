class LimeChatWhatsapp{constructor({accessToken:t,phoneNumber:e}){this.accessToken=t,this.phoneNumber=e,this.getConfig=this.getConfig.bind(this),this.initializeWidget=this.initializeWidget.bind(this),this.defaultWidgetIcon="https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_WA.png"}async getConfig(){try{let t=await fetch(`https://app-whatsapp-widget.limechat.ai/api/getWidgetConfig/${this.phoneNumber}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!t.ok)throw Error(`Error fetching config: ${t.status}`);let e=await t.json();return Object.assign(this,e),e}catch(t){return console.error("Error fetching config:",t),null}}async initializeWidget(){await this.getConfig()&&this.renderWidget()}deviceCheck(t){let e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return"desktop"===t&&!e||!("mobile"!==t||!e)||"both"===t||void 0}titleCase(t){let e=t.toLowerCase().split(" ");for(let t=0;t<e.length;t++)e[t]=e[t].charAt(0).toUpperCase()+e[t].substring(1);return e.join(" ")}renderWidget(){this.deviceCheck(this.display_on)&&this.renderButton()}pageCheck(t){let e=!1;return t.forEach((t=>{"homepage"==t&&"/"==window.location.pathname&&(e=!0),"collections"==t&&window.location.pathname.includes("/collections/")&&(e=!0),"products"==t&&window.location.pathname.includes("/products/")&&(e=!0),"cart"==t&&"/cart"==window.location.pathname&&(e=!0),"pages"==t&&window.location.pathname.includes("/pages/")&&(e=!0),"checkout"==t&&window.location.pathname.includes("/checkouts/")&&(e=!0),"blogs"==t&&window.location.pathname.includes("/blogs/")&&(e=!0)})),e}getParameterByName(t,e){t=t.replace(/[\[\]]/g,"\\$&");let s=RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}appendCurrentUrl(t){return this.utm_for_widget?`Hi, I was browsing ${encodeURIComponent(window.location.href)} and have a few questions`:t}renderButton(){if(this.pageCheck(this.pages_to_display)||!this.isShopify){let i=document.createElement("script");i.setAttribute("src","https://kit.fontawesome.com/2640aa91b4.js"),document.body.appendChild(i);let o=document.createElement("link");o.setAttribute("href","https://fonts.googleapis.com/css2?family=Lato&family=Roboto&display=swap"),o.setAttribute("rel","stylesheet"),document.body.appendChild(o);let p=document.createElement("link");p.setAttribute("href","https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/LC_whatsapp_stylesheet.css"),p.setAttribute("rel","stylesheet"),p.setAttribute("type","text/css"),document.body.appendChild(p);let l=1e3!==this.zIndex?this.zIndex:1e3,a=document.createElement("div");a.className="WhatsAppButton__root",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"left"===this.position_mobile?a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; left: ${this.left_margin_mobile}px; z-index: ${l};`):a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; right: ${this.right_margin_mobile}px; z-index: ${l};`):"left"===this.position_desktop?a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; left: ${this.left_margin_desktop}px; z-index: ${l};`):a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; right: ${this.right_margin_desktop}px; z-index: ${l};`),document.body.appendChild(a);let h=document.createElement("a"),n=document.createElement("a");if(window.location.pathname.includes("/products/")&&""!==this.pdp_prefill_text&&this.isShopify&&(window.location.href.includes("variant")&&!this.includeVariant||!window.location.href.includes("variant")&&this.includeVariant||!window.location.href.includes("variant")&&!this.includeVariant)){let i=window.location.href,o=i.split("/products/"),p="";var t=(p=o[1].includes("?")?o[1].split("?")[0]:o[1]).replace(/\-/g," ").replace(/\//g,""),e=`${p}.xml`;e=i.replace(p,e);var s=this.titleCase(t);fetch(e).then((t=>{t.text().then((t=>(new DOMParser).parseFromString(t,"text/xml"))).then((t=>t.querySelector("title"))).then((t=>t.textContent)).then((t=>{t=t.replaceAll("&","%26");try{let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}catch(t){let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${s}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}}))}))}else if(window.location.pathname.includes("/collections/")&&!window.location.pathname.includes("/products/")&&this.isShopify){let e=window.location.href.split("collections/"),s="";t=(s=e[1].includes("?")?e[1].split("?")[0]:e[1]).replace(/\-/g," ").replace(/\//g,"");let i=this.titleCase(t),o=this.appendCurrentUrl(`Hey! I would like to know more about ${i}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${o}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${o}`)}else if(window.location.pathname.includes("/products/")&&window.location.href.includes("variant")&&""!==this.pdp_prefill_text&&this.isShopify&&this.includeVariant){let i=window.location.href,o=i.split("products/"),p="";t=(p=o[1].includes("?")?o[1].split("?")[0]:o[1]).replace(/\-/g," ").replace(/\//g,""),e=`${p}.xml`,e=i.replace(p,e),s=this.titleCase(t);let l=this.getParameterByName("variant",window.location.href);fetch(e).then((t=>{t.text().then((t=>(new DOMParser).parseFromString(t,"text/xml"))).then((t=>[t.querySelectorAll("variant"),t.querySelector("title")])).then((t=>{for(let e of t[0])if(e.querySelector("id").textContent===l){let s=[],i=1,o=e.querySelector(`option${i}`);for(;o;)o.textContent&&s.push(o.textContent),i++,o=e.querySelector(`option${i}`);return[s.join(" / "),t[1].textContent]}})).then((t=>{try{let e=t[0].replace(/\-/g," ").replace(/\//g,""),s=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t[1].replaceAll("&","%26")} ${e}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${s}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${s}`)}catch(t){let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${s}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}}))})).catch((t=>{let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${s}`);h.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}))}else{let t=this.appendCurrentUrl(this.prefill_text);h.setAttribute("href",`https://wa.me/${this.phone}?text=${t}`),n.setAttribute("href",`https://wa.me/${this.phone}?text=${t}`)}if(h.setAttribute("style","text-decoration: none"),h.setAttribute("target","_blank"),a.appendChild(h),n.setAttribute("target","_blank"),n.setAttribute("class","whatsapp__poweredBy"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))if("widget_text"===this.widget_type_mobile){let t=document.createElement("button");t.setAttribute("class","landbot-whatsapp__button"),t.setAttribute("style",`min-width:${this.display_size_mobile}px; padding:${this.display_size_mobile/16}px`),h.appendChild(t);let e=document.createElement("i");e.setAttribute("class","fab fa-whatsapp"),e.setAttribute("style","font-size: 24px; margin-right: 5px"),t.appendChild(e);let s=document.createElement("p");s.setAttribute("style","margin: 0"),s.innerText=this.button_message_mobile,t.appendChild(s),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(n.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`))):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):n.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):n.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?n.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):n.setAttribute("style",`left: ${this.display_size_desktop+this.button_message_mobile.length+8}px;`))),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),n.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; right: 0px;`))}else{let t=document.createElement("img");t.src=this.widget_icon_mobile||this.defaultWidgetIcon,t.setAttribute("style",`width:${this.display_size_mobile}px; opacity:1`),t.setAttribute("alt","WhatsApp Icon"),h.appendChild(t),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`left: ${this.display_size_mobile+12}px;`)):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),n.setAttribute("style",`right: ${this.display_size_mobile+12}px;`)),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),n.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; right: 0px;`))}else if("widget_text"===this.widget_type_desktop){let t=document.createElement("button");t.setAttribute("class","landbot-whatsapp__button"),t.setAttribute("style",`min-width:${this.display_size_desktop}px; padding:${this.display_size_desktop/16}px`),h.appendChild(t);let e=document.createElement("i");e.setAttribute("class","fab fa-whatsapp"),e.setAttribute("style","font-size: 24px; margin-right: 5px"),t.appendChild(e);let s=document.createElement("p");s.setAttribute("style","margin: 0"),s.innerText=this.button_message_desktop,t.appendChild(s),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(n.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","left: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","left: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","left: 110%;"))):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","right: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","right: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,n.setAttribute("style","right: 110%;"))),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),n.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; right: 0px;`))}else{let t=document.createElement("img");t.src=this.widget_icon_desktop||this.defaultWidgetIcon,t.setAttribute("style",`width:${this.display_size_desktop}px; opacity:1`),t.setAttribute("alt","WhatsApp Icon"),h.appendChild(t),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`left: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;`)):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),n.setAttribute("style",`right: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;\n                \n                `)),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(n.setAttribute("class","whatsapp__poweredBy"),n.setAttribute("style",`bottom: ${this.display_size_desktop+12}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(n.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),n.setAttribute("style",`bottom: ${1.5*this.display_size_desktop}px; right: 0px;`))}document.createElement("div");let r=document.createElement("img");this.pop_up_image.length>2&&(r.src=this.pop_up_image,r.setAttribute("style","width:24px;\n            float:left;\n            height:24px;\n            margin-right: 5px;\n            margin-top:-4px;\n            border-radius: 50%;"));let _=document.createElement("img");_.src="https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_close.png",_.setAttribute("class","closePopUp"),_.removeAttribute("href"),_.addEventListener("click",(t=>{n.remove(),t.preventDefault()}),!1),n.innerText=this.pop_up_message_text,this.show_pop_up&&setTimeout((()=>{n.append(_),r.src.length>2&&n.prepend(r),a.appendChild(n)}),1e3*this.pop_up_delay)}}}
