class LimeChatWhatsapp{constructor({accessToken:t,phoneNumber:e}){this.accessToken=t,this.phoneNumber=e,this.getConfig=this.getConfig.bind(this),this.initializeWidget=this.initializeWidget.bind(this),this.appearanceTimers=new Set,this.mediaValidationTimers=new Set,this.popupTimers=new Set,window.addEventListener("beforeunload",(()=>this.cleanup())),window.addEventListener("unload",(()=>this.cleanup()))}hideWidgetWithTransition(t){this.widgetContainer&&(this.widgetContainer.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out",this.widgetContainer.style.transform="left"===t?"translateX(-100%)":"translateX(100%)",this.widgetContainer.style.opacity="0",setTimeout((()=>{this.widgetContainer.style.display="none"}),300));const e=document.getElementById("whatsapp-first-time-popup");e&&(e.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out",e.style.transform="left"===t?"translateX(-100%)":"translateX(100%)",e.style.opacity="0",setTimeout((()=>{e.parentNode&&(e.style.display="none")}),300))}showWidgetWithTransition(t){this.widgetContainer&&(this.widgetContainer.style.display="",this.widgetContainer.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out",this.widgetContainer.style.transform="left"===t?"translateX(-100%)":"translateX(100%)",this.widgetContainer.style.opacity="0",this.widgetContainer.offsetWidth,this.widgetContainer.style.transform="translateX(0)",this.widgetContainer.style.opacity="1");const e=document.getElementById("whatsapp-first-time-popup");e&&(e.style.display="",e.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out",e.style.transform="left"===t?"translateX(-100%)":"translateX(100%)",e.style.opacity="0",e.offsetWidth,e.style.transform="translateX(0)",e.style.opacity="1")}async getConfig(){try{const t=await fetch(`https://app-whatsapp-widget.limechat.ai/api/getWidgetConfig/${this.phoneNumber}`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!t.ok)throw new Error(`Error fetching config: ${t.status}`);const e=await t.json();return e.popup_configs&&(this.popup_configs="string"==typeof e.popup_configs?JSON.parse(e.popup_configs):e.popup_configs),this.popup_message_enabled=e.popup_message_enabled||!1,Object.assign(this,e),e}catch(t){return console.error("Error fetching config:",t),null}}async initializeWidget(){await this.getConfig()&&this.renderWidget()}deviceCheck(t){const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return"desktop"===t&&!e||!("mobile"!==t||!e)||"both"===t||void 0}titleCase(t){const e=t.toLowerCase().split(" ");for(let t=0;t<e.length;t++)e[t]=e[t].charAt(0).toUpperCase()+e[t].substring(1);return e.join(" ")}renderWidget(){this.deviceCheck(this.display_on)&&this.renderButton()}pageCheck(t){let e=!1;return t.forEach((t=>{"homepage"==t&&"/"==window.location.pathname&&(e=!0),"collections"==t&&window.location.pathname.includes("/collections/")&&(e=!0),"products"==t&&window.location.pathname.includes("/products/")&&(e=!0),"cart"==t&&"/cart"==window.location.pathname&&(e=!0),"pages"==t&&window.location.pathname.includes("/pages/")&&(e=!0),"checkout"==t&&window.location.pathname.includes("/checkouts/")&&(e=!0),"blogs"==t&&window.location.pathname.includes("/blogs/")&&(e=!0)})),e||!this.isShopify}getParameterByName(t,e){t=t.replace(/[\[\]]/g,"\\$&");const i=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}appendCurrentUrl(t){return this.utm_for_widget?`Hi, I was browsing ${encodeURIComponent(window.location.href)} and have a few questions`:t}createFirstTimePopup(){if(!this.popup_message_enabled||!this.popup_configs)return;const t=this.getPopupConfig();if(!t)return;if(!this.hasValidPopupContent(t))return;const e=this.createPopupContainer(),i=this.createPopupContent(t);e.appendChild(i),this.positionAndShowPopup(e,t),this.setupPopupBehavior(e,t),this.setupEventListeners(e,t)}hasValidPopupContent(t){const e=t.cta&&""!==t.cta.trim(),i=t.media_header&&""!==t.media_header.trim(),s=t.header&&""!==t.header.trim(),o=t.title&&""!==t.title.trim(),p=t.body&&""!==t.body.trim();return e||i||s||o||p}getPopupConfig(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.popup_configs.mobile:this.popup_configs.desktop}createPopupContainer(){const t=document.createElement("div");return t.id="whatsapp-first-time-popup",t.className="whatsapp-first-time-popup",t}createPopupContent(t){const e=document.createElement("div");e.className="whatsapp-popup-content",e.appendChild(this.createCloseButton());const i=document.createElement("div");i.className="whatsapp-media-placeholder",e.appendChild(i);return(t.header||t.body||t.cta)&&e.appendChild(this.createTextContainer(t)),""!==t.media_header?.trim()?"video"===t.popup_type?this.validateAndCreateVideo(t.media_header,e,i):this.validateAndCreateImage(t.media_header,(()=>{const s=this.createImageContainer(t.media_header);(t.header||t.body)&&this.validateAndCreateCompanyImage(t.company_image,(()=>{const i=this.createCompanyImageContainer(t.company_image);s.appendChild(i),e.classList.add("whatsapp-has-company-image")})),e.insertBefore(s,i),e.removeChild(i)})):e.removeChild(i),e}createCloseButton(){const t=document.createElement("span");return t.id="whatsapp-close-popup",t.className="whatsapp-popup-close-button",t.textContent="âœ•",t}isValidUrl(t){try{return new URL(t),!0}catch{return!1}}validateAndCreateImage=(t,e)=>{if(!this.isValidUrl(t))return void console.warn("Invalid image URL format:",t);const i=new Image;i.onload=()=>e(),i.onerror=()=>console.warn("Failed to load image:",t);const s=setTimeout((()=>{i.complete||console.warn("Image loading timeout:",t),this.mediaValidationTimers.delete(s)}),1e4);this.mediaValidationTimers.add(s),i.src=t};validateAndCreateVideo(t,e,i){if(!this.isValidUrl(t))return console.warn("Invalid video URL format:",t),void(i&&i.parentNode&&e.removeChild(i));const s=document.createElement("video");s.onloadedmetadata=()=>{const s=this.createVideoContainer(t);i&&i.parentNode?(e.insertBefore(s,i),e.removeChild(i)):e.appendChild(s)},s.onerror=()=>{console.warn("Failed to load video:",t),i&&i.parentNode&&e.removeChild(i)},s.onabort=()=>{console.warn("Video loading aborted:",t),i&&i.parentNode&&e.removeChild(i)};const o=setTimeout((()=>{0===s.readyState&&(console.warn("Video loading timeout:",t),i&&i.parentNode&&e.removeChild(i)),this.mediaValidationTimers.delete(o)}),15e3);this.mediaValidationTimers.add(o),s.src=t,s.load()}createImageContainer(t){const e=document.createElement("div");e.className="whatsapp-popup-image-container";const i=document.createElement("img");return i.className="whatsapp-popup-image",i.src=t,i.alt="Popup image",e.appendChild(i),e}createVideoContainer(t){const e=document.createElement("div");e.className="whatsapp-popup-image-container";const i=document.createElement("video");return i.className="whatsapp-popup-image",i.src=t,i.autoplay=!0,i.muted=!0,i.loop=!0,i.playsInline=!0,i.controls=!1,i.setAttribute("preload","auto"),e.appendChild(i),e}createTextContainer(t){const e=document.createElement("div");if(e.className="whatsapp-popup-text-container",t.header||t.body){const i=document.createElement("div");if(i.className="whatsapp-popup-text-content",t.header){const e=document.createElement("h3");e.className="whatsapp-popup-header",e.textContent=t.header,i.appendChild(e)}if(t.body){const e=document.createElement("p");e.className="whatsapp-popup-body",e.textContent=t.body,i.appendChild(e)}e.appendChild(i)}if(t.cta){const i=document.createElement("div");i.className="whatsapp-popup-cta-container";const s=document.createElement("button");s.id="whatsapp-cta-button",s.className="whatsapp-popup-cta-button",s.textContent=t.cta,i.appendChild(s),e.appendChild(i)}return e}createCompanyImageContainer(t){const e=document.createElement("div");e.className="whatsapp-popup-company-image-container";const i=document.createElement("img");return i.className="whatsapp-popup-company-image",i.src=t,i.alt="Company logo",e.appendChild(i),e}positionAndShowPopup(t,e){const i=document.querySelector(".WhatsAppButton__root");i?(this.addPositioningClasses(t,e),i.parentNode.insertBefore(t,i)):document.body.appendChild(t),this.addPopupStyles(void 0,e),this.showPopupWithDelay(t,e)}addPositioningClasses(t,e){const i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.position_mobile:this.position_desktop,s=e.message_position||"top";t.className+=` whatsapp-popup-${s}-${i}`,e.popup_type&&(t.className+=` popup-type-${e.popup_type}`)}showPopupWithDelay(t,e){const i=e.time_to_appear?parseInt(e.time_to_appear,10):1,s=setTimeout((()=>{t.style.opacity="1",t.style.transform="translateY(0)",t._disappearTimer&&t._disappearTimer.start&&t._disappearTimer.start(),this.appearanceTimers.delete(s)}),1e3*i);this.appearanceTimers.add(s)}setupPopupBehavior(t,e){let i=null;if(e.time_to_disappear){const s=1e3*parseInt(e.time_to_disappear,10),o=()=>{i&&clearTimeout(i),i=setTimeout((()=>{this.closePopupGracefully(t)}),s)},p=()=>{i&&(clearTimeout(i),i=null)},n=()=>{i||o()};t.addEventListener("mouseenter",p),t.addEventListener("mouseleave",n);const a={start:o,pause:p,restart:n,clear:()=>{i&&(clearTimeout(i),i=null)}};t._disappearTimer=a,this.popupTimers.add(a)}}setupEventListeners(t,e){const i=t.querySelector("#whatsapp-close-popup"),s=t.querySelector("#whatsapp-cta-button");i&&i.addEventListener("click",(e=>{e.stopPropagation(),this.closePopupGracefully(t)})),s&&s.addEventListener("click",(e=>{e.stopPropagation(),this.handleCtaClick(t)})),e.cta&&"video"!==e.popup_type||t.addEventListener("click",(i=>{"whatsapp-close-popup"!==i.target.id&&null===i.target.closest("#whatsapp-close-popup")&&(this.closePopupGracefully(t),this.openWhatsApp("video"===e.popup_type?"video_popup_click":"popup_click"))}))}handleCtaClick(t){this.closePopupGracefully(t),this.openWhatsApp("popup_cta")}openWhatsApp(t="widget_icon"){this.logWidgetClick(t);const e=document.querySelector(".WhatsAppButton__root a");e&&window.open(e.href,"_blank")}getSessionId(){let t=sessionStorage.getItem("limechat_widget_session_id");return t||(t=Math.random().toString(36).substring(2,14),sessionStorage.setItem("limechat_widget_session_id",t)),t}getDeviceType(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop"}async logWidgetClick(t){try{const t=await fetch(`https://app.limechat.ai/widget_config?website_token=${this.accessToken}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Config API failed: ${t.status}`);const e=(await t.json()).inbox_id;if(!e)throw new Error("inbox_id not found in config response");const i=this.getSessionId(),s={session_id:i,inbox_id:e,device_type:this.getDeviceType()},o=await fetch("https://app.limechat.ai/api/v1/widget/widget_click_events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error(`Click event API failed: ${o.status}`)}catch(t){console.warn("Failed to send analytics:",t)}}closePopupGracefully(t){t&&t.parentNode&&(t._disappearTimer&&(t._disappearTimer.clear(),this.popupTimers.delete(t._disappearTimer)),t.classList.add("whatsapp-popup-hidden"),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),300))}addPopupStyles(t="#25d366",e={}){if(document.getElementById("whatsapp-popup-styles"))return;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);const i=(t,e)=>{const{bottom:i,left:s,right:o}=t;return{topPosition:{bottom:i+e,left:s,right:o},sidePosition:{bottom:i,left:s+e+10,right:o+e+10}}},s=i({bottom:parseInt(this.bottom_margin_desktop||24),left:parseInt(this.left_margin_desktop||24),right:parseInt(this.right_margin_desktop||24)},parseInt(this.display_size_desktop||60)),o=i({bottom:parseInt(this.bottom_margin_mobile||24),left:parseInt(this.left_margin_mobile||24),right:parseInt(this.right_margin_mobile||24)},parseInt(this.display_size_mobile||60)),p=document.createElement("style");p.id="whatsapp-popup-styles",p.textContent=`\n      .whatsapp-first-time-popup {\n        position: fixed;\n        z-index: 999999;\n        opacity: 0;\n        transform: translateY(20px);\n        transition: opacity 0.3s ease-out, transform 0.3s ease-out;\n        max-width: 200px;\n        background-color: transparent;\n        overflow: visible;\n        padding: 15px;\n      }\n\n      .whatsapp-first-time-popup.whatsapp-popup-hidden {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n\n      /* Video popup specific styling for desktop */\n      .whatsapp-first-time-popup.popup-type-video {\n        max-width: 251px;\n        padding: 4px;\n      }\n\n      .whatsapp-popup-top-right {\n        bottom: ${s.topPosition.bottom}px;\n        right: ${s.topPosition.right}px;\n      }\n\n      .whatsapp-popup-top-left {\n        bottom: ${s.topPosition.bottom}px;\n        left: ${s.topPosition.left}px;\n      }\n\n      .whatsapp-popup-side-right {\n        bottom: ${s.sidePosition.bottom}px;\n        right: ${s.sidePosition.right}px;\n      }\n\n      .whatsapp-popup-side-left {\n        bottom: ${s.sidePosition.bottom}px;\n        left: ${s.sidePosition.left}px;\n      }\n\n      .whatsapp-popup-content {\n        position: relative;\n        padding: 5px;\n        background-color: white;\n        border-radius: 12px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        overflow: visible;\n      }\n\n      /* Video popup content styling for desktop */\n      .popup-type-video .whatsapp-popup-content {\n        width: 172px;\n        height: 262px;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .whatsapp-popup-close-button {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        position: absolute;\n        top: -12px;\n        right: -10px;\n        background-color: white;\n        color: #808975;\n        font-size: 12px;\n        font-weight: normal;\n        line-height: 1;\n        width: 22px;\n        height: 22px;\n        border-radius: 50%;\n        border: 0.5px solid silver;\n        padding: 0;\n        margin: 0;\n        box-sizing: border-box;\n        user-select: none;\n      }\n\n      .whatsapp-popup-close-button:hover {\n        background-color: #e0e0e0;\n      }\n\n      .whatsapp-popup-image-container {\n        width: 100%;\n        height: 90px;\n        border-radius: 10px;\n        position: relative;\n      }\n\n      /* Video container styling for desktop */\n      .popup-type-video .whatsapp-popup-image-container {\n        flex: 1;\n        position: relative;\n      }\n\n      .whatsapp-popup-image {\n        width: 100%;\n        height: 100%;\n        border-radius: 10px;\n        object-fit: cover;\n      }\n\n      .whatsapp-popup-text-container {\n        padding: 0px;\n      }\n\n      .whatsapp-popup-text-content {\n        padding: 0px 8px;\n      }\n\n      .whatsapp-popup-company-image-container {\n        position: absolute;\n        bottom: -16px;\n        left: 50%;\n        transform: translateX(-50%);\n      }\n\n      .whatsapp-popup-company-image {\n        width: 28px;\n        height: 28px;\n        border-radius: 50%;\n        object-fit: cover;\n        border: 2px solid #fff;\n      }\n\n      /* Adjust spacing when company image is present */\n      .whatsapp-popup-content.whatsapp-has-company-image .whatsapp-popup-text-content {\n        padding-top: 10px;\n      }\n\n      .whatsapp-popup-header {\n        font-size: 12px;\n        font-weight: 600;\n        margin: 8px 0px 4px 0px;\n        padding: 0px;\n        letter-spacing: 0.2px;\n        line-height: 1.4;\n        color: #262626;\n      }\n\n      /* Add bottom margin to header only if there's content after it */\n      .whatsapp-popup-header + .whatsapp-popup-body {\n        margin-top: 8px;\n      }\n\n      .whatsapp-popup-body {\n        margin: 4px 0px;\n        padding: 0px;\n        font-size: 11px;\n        font-weight: 400;\n        color: #434343;\n        line-height: 18px;\n      }\n\n      /* Add bottom margin to text content wrapper if there's CTA after it */\n      .whatsapp-popup-text-content + .whatsapp-popup-cta-container {\n        margin-top: 8px;\n      }\n\n      .whatsapp-popup-cta-container {\n        margin: 0;\n      }\n\n      .whatsapp-popup-cta-button {\n        width: 100%;\n        background-color: ${t};\n        color: white;\n        border: none;\n        border-radius: 8px;\n        padding: 10px 16px;\n        font-weight: 600;\n        font-size: 12px;\n        text-align: center;\n        text-transform: capitalize;\n        line-height: 20px;\n        cursor: pointer;\n      }\n\n      .whatsapp-popup-cta-button:hover {\n        opacity: 0.9;\n      }\n\n      /* Remove any triangle/pointer styles */\n      .whatsapp-first-time-popup::before,\n      .whatsapp-first-time-popup::after {\n        content: none !important;\n        display: none !important;\n      }\n\n      /* Mobile adjustments */\n      @media (max-width: 670px) {\n        .whatsapp-first-time-popup {\n          max-width: 200px;\n          padding: 12px;\n        }\n\n        /* Video popup specific styling for mobile */\n        .whatsapp-first-time-popup.popup-type-video {\n          max-width: 172px;\n          padding: 4px;\n        }\n\n        /* Video popup content styling for mobile */\n        .popup-type-video .whatsapp-popup-content {\n          width: 172px;\n          height: 262px;\n          border-radius: 12px;\n          display: flex;\n          flex-direction: column;\n        }\n\n        /* Video container styling for mobile */\n        .popup-type-video .whatsapp-popup-image-container {\n          flex: 1;\n          border-radius: 12px;\n          overflow: hidden;\n        }\n\n        .whatsapp-popup-top-right {\n          bottom: ${o.topPosition.bottom}px;\n          right: ${o.topPosition.right}px;\n        }\n\n        .whatsapp-popup-top-left {\n          bottom: ${o.topPosition.bottom}px;\n          left: ${o.topPosition.left}px;\n        }\n\n        .whatsapp-popup-side-right {\n          bottom: ${o.sidePosition.bottom}px;\n          right: ${o.sidePosition.right}px;\n        }\n\n        .whatsapp-popup-side-left {\n          bottom: ${o.sidePosition.bottom}px;\n          left: ${o.sidePosition.left}px;\n        }\n      }\n    `,document.head.appendChild(p)}renderButton(){if(this.pageCheck(this.pages_to_display)||!this.isShopify){const s=document.createElement("script");s.setAttribute("src","https://kit.fontawesome.com/2640aa91b4.js"),document.body.appendChild(s);const o=document.createElement("link");o.setAttribute("href","https://fonts.googleapis.com/css2?family=Lato&family=Roboto&display=swap"),o.setAttribute("rel","stylesheet"),document.body.appendChild(o);const p=document.createElement("link");p.setAttribute("href","https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/LC_whatsapp_stylesheet.css"),p.setAttribute("rel","stylesheet"),p.setAttribute("type","text/css"),document.body.appendChild(p);const n=1e3!==this.zIndex?this.zIndex:1e3,a=document.createElement("div");a.className="WhatsAppButton__root",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"left"===this.position_mobile?a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; left: ${this.left_margin_mobile}px; z-index: ${n};`):a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_mobile}px; right: ${this.right_margin_mobile}px; z-index: ${n};`):"left"===this.position_desktop?a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; left: ${this.left_margin_desktop}px; z-index: ${n};`):a.setAttribute("style",`position: fixed; bottom: ${this.bottom_margin_desktop}px; right: ${this.right_margin_desktop}px; z-index: ${n};`),document.body.appendChild(a);const r=document.createElement("a"),l=document.createElement("a");if(window.location.pathname.includes("/products/")&&""!==this.pdp_prefill_text&&this.isShopify&&(window.location.href.includes("variant")&&!this.includeVariant||!window.location.href.includes("variant")&&this.includeVariant||!window.location.href.includes("variant")&&!this.includeVariant)){const s=window.location.href,o=s.split("/products/");let p="";p=o[1].includes("?")?o[1].split("?")[0]:o[1];var t=p.replace(/\-/g," ").replace(/\//g,""),e=`${p}.xml`;e=s.replace(p,e);var i=this.titleCase(t);fetch(e).then((t=>{t.text().then((t=>(new DOMParser).parseFromString(t,"text/xml"))).then((t=>t.querySelector("title"))).then((t=>t.textContent)).then((t=>{t=t.replaceAll("&","%26");try{let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t}`);r.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}catch(t){let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${i}`);r.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}}))}))}else if(window.location.pathname.includes("/collections/")&&!window.location.pathname.includes("/products/")&&this.isShopify){const e=window.location.href.split("collections/");let i="";i=e[1].includes("?")?e[1].split("?")[0]:e[1],t=i.replace(/\-/g," ").replace(/\//g,"");const s=this.titleCase(t),o=this.appendCurrentUrl("Hey! I would like to know more about");r.setAttribute("href",`https://wa.me/${this.phone}?text=${o} ${s}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${o} ${s}`)}else if(window.location.pathname.includes("/products/")&&window.location.href.includes("variant")&&""!==this.pdp_prefill_text&&this.isShopify&&this.includeVariant){const s=window.location.href,o=s.split("products/");let p="";p=o[1].includes("?")?o[1].split("?")[0]:o[1],t=p.replace(/\-/g," ").replace(/\//g,""),e=`${p}.xml`,e=s.replace(p,e),i=this.titleCase(t);const n=this.getParameterByName("variant",window.location.href);fetch(e).then((t=>{t.text().then((t=>(new DOMParser).parseFromString(t,"text/xml"))).then((t=>[t.querySelectorAll("variant"),t.querySelector("title")])).then((t=>{for(const e of t[0])if(e.querySelector("id").textContent===n){const i=[];let s=1,o=e.querySelector(`option${s}`);for(;o;)o.textContent&&i.push(o.textContent),s++,o=e.querySelector(`option${s}`);return[i.join(" / "),t[1].textContent]}})).then((t=>{try{const e=t[0].replace(/\-/g," ").replace(/\//g,""),i=this.appendCurrentUrl(`${this.pdp_prefill_text} ${t[1].replaceAll("&","%26")} ${e}`);r.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${i}`)}catch(t){let e=this.appendCurrentUrl(`${this.pdp_prefill_text} ${i}`);r.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${e}`)}}))})).catch((t=>{r.setAttribute("href",`https://wa.me/${this.phone}?text=${this.pdp_prefill_text} ${i}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${this.pdp_prefill_text} ${i}`)}))}else{let t=this.appendCurrentUrl(this.prefill_text);r.setAttribute("href",`https://wa.me/${this.phone}?text=${t}`),l.setAttribute("href",`https://wa.me/${this.phone}?text=${t}`)}if(r.setAttribute("style","text-decoration: none"),r.setAttribute("target","_blank"),r.addEventListener("click",(t=>{this.logWidgetClick("widget_icon")})),a.appendChild(r),l.setAttribute("target","_blank"),l.setAttribute("class","whatsapp__poweredBy"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))if("widget_text"===this.widget_type_mobile){const t=document.createElement("button");t.setAttribute("class","landbot-whatsapp__button"),t.setAttribute("style",`min-width:${this.display_size_mobile}px; padding:${this.display_size_mobile/16}px`),r.appendChild(t);const e=document.createElement("i");e.setAttribute("class","fab fa-whatsapp"),e.setAttribute("style","font-size: 24px; margin-right: 5px"),t.appendChild(e);const i=document.createElement("p");i.setAttribute("style","margin: 0"),i.innerText=this.button_message_mobile,t.appendChild(i),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):l.setAttribute("style",`left: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`))):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+40}px;`):l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+12}px;`)),140===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+20}px;`):l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`)),160===this.display_size_mobile&&(19===this.button_message_mobile.length||20===this.button_message_mobile.length?l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+10}px;`):l.setAttribute("style",`right: ${this.display_size_mobile+this.button_message_mobile.length+8}px;`))),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_mobile/2.5+2}px; right: 0px;`))}else{const t=document.createElement("img");t.src=this.widget_icon_mobile||"https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_WA.png",t.setAttribute("style",`width:${this.display_size_mobile}px; opacity:1`),t.setAttribute("alt","WhatsApp Icon"),r.appendChild(t),"left"===this.position_mobile&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`left: ${this.display_size_mobile+12}px;`)):"right"===this.position_mobile&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),l.setAttribute("style",`right: ${this.display_size_mobile+12}px;`)),"top"===this.pop_up_message_position&&"left"===this.position_mobile?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_mobile&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_mobile+14}px; right: 0px;`))}else if("widget_text"===this.widget_type_desktop){const t=document.createElement("button");t.setAttribute("class","landbot-whatsapp__button"),t.setAttribute("style",`min-width:${this.display_size_desktop}px; padding:${this.display_size_desktop/16}px`),r.appendChild(t);const e=document.createElement("i");e.setAttribute("class","fab fa-whatsapp"),e.setAttribute("style","font-size: 24px; margin-right: 5px"),t.appendChild(e);const i=document.createElement("p");i.setAttribute("style","margin: 0"),i.innerText=this.button_message_desktop,t.appendChild(i),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","left: 110%;"))):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),120===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;")),140===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;")),160===this.display_size_desktop&&(19===this.button_message_desktop.length||this.button_message_desktop.length,l.setAttribute("style","right: 110%;"))),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${this.display_size_desktop/2.7+2}px; right: 0px;`))}else{const t=document.createElement("img");t.src=this.widget_icon_desktop||"https://s3.ap-south-1.amazonaws.com/cdn.limechat.ai/packs/js/whatsapp_widget/media/LC_WA.png",t.setAttribute("style",`width:${this.display_size_desktop}px; opacity:1`),t.setAttribute("alt","WhatsApp Icon"),r.appendChild(t),"left"===this.position_desktop&&"top"!==this.pop_up_message_position?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`left: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;`)):"right"===this.position_desktop&&"top"!==this.pop_up_message_position&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredBySideLefty"),l.setAttribute("style",`right: ${this.display_size_desktop+12}px; bottom: ${.2*this.display_size_desktop}px;`)),"top"===this.pop_up_message_position&&"left"===this.position_desktop?(l.setAttribute("class","whatsapp__poweredBy"),l.setAttribute("style",`bottom: ${this.display_size_desktop+12}px; left: 0px;`)):"top"===this.pop_up_message_position&&"right"===this.position_desktop&&(l.setAttribute("class","whatsapp__poweredBy whatsapp__poweredByTopRight"),l.setAttribute("style",`bottom: ${1.5*this.display_size_desktop}px; right: 0px;`))}setTimeout((()=>{this.createFirstTimePopup()}),500),this.widgetContainer=a,this.setupScrollHandler()}}cleanup(){this.appearanceTimers.forEach((t=>clearTimeout(t))),this.appearanceTimers.clear(),this.mediaValidationTimers.forEach((t=>clearTimeout(t))),this.mediaValidationTimers.clear(),this.popupTimers.forEach((t=>{t&&t.clear&&t.clear()})),this.popupTimers.clear()}validateAndCreateCompanyImage(t,e){if(!this.isValidUrl(t))return void console.warn("Invalid company image URL format:",t);const i=new Image;i.onload=()=>e(),i.onerror=()=>console.warn("Failed to load company image:",t);const s=setTimeout((()=>{i.complete||console.warn("Company image loading timeout:",t),this.mediaValidationTimers.delete(s)}),1e4);this.mediaValidationTimers.add(s),i.src=t}setupScrollHandler(){const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(!(t?this.disappear_on_scroll_mobile:this.disappear_on_scroll_desktop))return;const e=t?this.scroll_distance_mobile||100:this.scroll_distance_desktop||100;let i=window.pageYOffset,s=!1,o=null;window.addEventListener("scroll",(()=>{const p=window.pageYOffset;if(!s&&Math.abs(p-i)>e){const e=t?this.position_mobile:this.position_desktop;this.hideWidgetWithTransition(e),s=!0}s&&(o&&clearTimeout(o),o=setTimeout((()=>{const e=t?this.position_mobile:this.position_desktop;this.showWidgetWithTransition(e),s=!1,i=window.pageYOffset}),1500))}))}}
